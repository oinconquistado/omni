---
title: Shared Schema
description: Multi-tenant client database schema for users, products, categories, and inventory management
---

# Shared Schema

The **Shared Database** manages multi-tenant client data including client users, products, categories, and inventory across all customer companies.

**Database URL**: `SHARED_DATABASE_URL`  
**Prisma Client**: `@prisma/shared-client`

## Models Overview

- [Category](#category) - Product categorization system
- [ClientSession](#clientsession) - Authentication sessions for client users
- [ClientUser](#clientuser) - Users within client companies
- [Product](#product) - Inventory products with pricing and details
- [Stock](#stock) - Inventory levels and stock management

---

## Category

Product categorization system for organizing inventory within each tenant.

### Fields

| Field | Type | Description |
|-------|------|-------------|
| `id` | String | Unique identifier (CUID) |
| `tenantId` | String | Tenant isolation identifier |
| `name` | String | Category name |
| `description` | String? | Optional category description |
| `createdAt` | DateTime | Creation timestamp |
| `updatedAt` | DateTime | Last modification timestamp |

### Constraints

- `[tenantId, name]` must be unique (one category name per tenant)

### Usage Example

```typescript
// Create product category for tenant
const category = await sharedService.createCategory({
  tenantId: "tenant-123",
  name: "Electronics",
  description: "Electronic devices and accessories"
});
```

---

## ClientSession

Authentication sessions for users within client companies.

### Fields

| Field | Type | Description |
|-------|------|-------------|
| `id` | String | Unique session identifier (CUID) |
| `tenantId` | String | Tenant isolation identifier |
| `clientUserId` | String | Reference to ClientUser who owns this session |
| `token` | String | Unique session token |
| `expiresAt` | DateTime | Session expiration timestamp |
| `createdAt` | DateTime | Session creation timestamp |

### Relationships

- `clientUser` → ClientUser (session owner, cascading delete)

### Constraints

- `token` must be unique across all client sessions

### Usage Example

```typescript
// Create client user session
const session = await sharedService.createClientSession({
  tenantId: "tenant-123",
  clientUserId: "client-user-id",
  token: "generated-session-token",
  expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000)
});
```

---

## ClientUser

Users within client companies who access the inventory management system.

### Fields

| Field | Type | Description |
|-------|------|-------------|
| `id` | String | Unique identifier (CUID) |
| `tenantId` | String | Tenant isolation identifier |
| `email` | String | Email address |
| `name` | String | Full name |
| `role` | ClientUserRole | Access level within the company |
| `status` | ClientUserStatus | Account status |
| `createdAt` | DateTime | Account creation timestamp |
| `updatedAt` | DateTime | Last modification timestamp |

### Relationships

- `sessions` → ClientSession[] (user's active sessions)

### Enums

**ClientUserRole**:
- `ADMIN` - Full access to company's inventory system
- `SALESPERSON` - Sales-focused access for inventory operations (default)

**ClientUserStatus**:
- `ACTIVE` - Active user account (default)
- `INACTIVE` - Temporarily disabled account
- `SUSPENDED` - Account suspended

### Constraints

- `[tenantId, email]` must be unique (one email per tenant)

### Usage Example

```typescript
// Create client user for tenant company
const clientUser = await sharedService.createClientUser({
  tenantId: "tenant-123",
  email: "john@acme.com",
  name: "John Smith",
  role: "SALESPERSON"
});
```

---

## Product

Inventory products with pricing, details, and categorization for each tenant.

### Fields

| Field | Type | Description |
|-------|------|-------------|
| `id` | String | Unique identifier (CUID) |
| `tenantId` | String | Tenant isolation identifier |
| `sku` | String | Stock Keeping Unit (product code) |
| `name` | String | Product name |
| `description` | String? | Optional product description |
| `price` | Decimal | Product price (10,2 precision) |
| `status` | ProductStatus | Product availability status |
| `createdAt` | DateTime | Creation timestamp |
| `updatedAt` | DateTime | Last modification timestamp |

### Enums

**ProductStatus**:
- `ACTIVE` - Available for sale (default)
- `INACTIVE` - Temporarily unavailable
- `DISCONTINUED` - No longer available

### Constraints

- `[tenantId, sku]` must be unique (one SKU per tenant)

### Usage Example

```typescript
// Create new product for tenant
const product = await sharedService.createProduct({
  tenantId: "tenant-123",
  sku: "LAPTOP-001",
  name: "Gaming Laptop",
  description: "High-performance gaming laptop",
  price: new Decimal("1299.99"),
  status: "ACTIVE"
});
```

---

## Stock

Inventory levels and stock management with quantity tracking and reorder levels.

### Fields

| Field | Type | Description |
|-------|------|-------------|
| `id` | String | Unique identifier (CUID) |
| `tenantId` | String | Tenant isolation identifier |
| `productId` | String | Reference to Product |
| `quantity` | Int | Total stock quantity (default: 0) |
| `reservedQty` | Int | Reserved/allocated quantity (default: 0) |
| `availableQty` | Int | Available for sale quantity (default: 0) |
| `reorderLevel` | Int? | Minimum stock level trigger |
| `maxStockLevel` | Int? | Maximum stock capacity |
| `lastUpdated` | DateTime | Last stock modification timestamp |

### Constraints

- `[tenantId, productId]` must be unique (one stock record per product per tenant)

### Business Logic

- `availableQty = quantity - reservedQty`
- Alert when `quantity <= reorderLevel`
- Prevent overstocking when `quantity > maxStockLevel`

### Usage Example

```typescript
// Update stock levels for product
const stock = await sharedService.updateStock({
  tenantId: "tenant-123",
  productId: "product-id",
  quantity: 100,
  reservedQty: 15,
  availableQty: 85,
  reorderLevel: 20,
  maxStockLevel: 500
});
```

## Database Configuration

### Prisma Schema Location
`apps/omni-server/prisma/shared-schema.prisma`

### Generated Client Location
`apps/omni-server/src/generated/shared-client/`

### Service Layer
`apps/omni-server/src/services/shared-service.ts`

## Multi-Tenancy Implementation

All models include `tenantId` for complete data isolation:

```typescript
// All queries must include tenant filtering
const products = await sharedDb.product.findMany({
  where: {
    tenantId: userTenantId, // Always filter by tenant
    status: "ACTIVE"
  }
});
```